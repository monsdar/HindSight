# Generated by Django 5.2 on 2025-12-24 08:18

import datetime
from django.db import migrations, models
from django.utils import timezone


def convert_date_to_datetime(apps, schema_editor):
    """Convert DateField values to DateTimeField values."""
    Season = apps.get_model('predictions', 'Season')
    db_alias = schema_editor.connection.alias
    
    for season in Season.objects.using(db_alias).all():
        updates = {}
        
        # Convert start_date from date to datetime (use midnight)
        if season.start_date:
            if isinstance(season.start_date, datetime.date) and not isinstance(season.start_date, datetime.datetime):
                start_dt = datetime.datetime.combine(season.start_date, datetime.time(0, 0, 0))
                if timezone.is_naive(start_dt):
                    start_dt = timezone.make_aware(start_dt)
                updates['start_date'] = start_dt
        
        # Convert end_date from date to datetime (use end of day)
        if season.end_date:
            if isinstance(season.end_date, datetime.date) and not isinstance(season.end_date, datetime.datetime):
                end_dt = datetime.datetime.combine(season.end_date, datetime.time(23, 59, 59))
                if timezone.is_naive(end_dt):
                    end_dt = timezone.make_aware(end_dt)
                updates['end_date'] = end_dt
        
        if updates:
            Season.objects.using(db_alias).filter(pk=season.pk).update(**updates)


def reverse_datetime_to_date(apps, schema_editor):
    """Reverse: convert DateTimeField back to DateField."""
    Season = apps.get_model('predictions', 'Season')
    db_alias = schema_editor.connection.alias
    
    for season in Season.objects.using(db_alias).all():
        updates = {}
        
        if season.start_date and isinstance(season.start_date, datetime.datetime):
            updates['start_date'] = season.start_date.date()
        
        if season.end_date and isinstance(season.end_date, datetime.datetime):
            updates['end_date'] = season.end_date.date()
        
        if updates:
            Season.objects.using(db_alias).filter(pk=season.pk).update(**updates)


class Migration(migrations.Migration):

    dependencies = [
        ('predictions', '0025_remove_seasonparticipant_predictions_season__1b65a9_idx_and_more'),
    ]

    operations = [
        # First, convert existing DateField data to DateTimeField
        migrations.RunPython(convert_date_to_datetime, reverse_datetime_to_date),
        # Then change the field types
        migrations.AlterField(
            model_name='season',
            name='end_date',
            field=models.DateTimeField(),
        ),
        migrations.AlterField(
            model_name='season',
            name='start_date',
            field=models.DateTimeField(),
        ),
    ]
