{% extends 'base.html' %}

{% block title %}HoopTipp &ndash; Leaderboard{% endblock %}

{% block nav %}
  <div class="flex items-center gap-3 text-sm font-semibold text-slate-300">
    <a href="{% url 'predictions:home' %}" class="rounded-full px-3 py-1 text-slate-400 transition hover:text-slate-100">Weekly picks</a>
    <a href="{% url 'predictions:leaderboard' %}" class="rounded-full bg-slate-800 px-3 py-1 text-slate-100 shadow-inner shadow-slate-900/60">Leaderboard</a>
  </div>
{% endblock %}

{% block content %}
  <div class="space-y-8">
    <section class="space-y-3">
      <h1 class="text-3xl font-bold text-amber-300">Leaderboard</h1>
      <p class="max-w-2xl text-slate-300">
        Track how players are performing across all scored events. Filter by tip type or segment to compare specific groupings,
        and sort by overall points, bonus hauls, or lock multipliers.
      </p>
    </section>

    <section class="space-y-5 rounded-2xl border border-slate-800 bg-slate-900 p-5 shadow-lg shadow-slate-900/30">
      <form method="get" class="grid gap-4 lg:grid-cols-4">
        <div class="flex flex-col gap-2">
          <label for="filter-tip-type" class="text-xs font-semibold uppercase tracking-wide text-slate-500">Tip type</label>
          <select
            id="filter-tip-type"
            name="tip_type"
            class="rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 text-sm text-slate-100 focus:outline-none focus:ring-2 focus:ring-amber-400"
          >
            <option value="">All tip types</option>
            {% for tip_type in tip_types %}
              <option value="{{ tip_type.slug }}" {% if tip_type.slug == selected_tip_type %}selected{% endif %}>{{ tip_type.name }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="flex flex-col gap-2">
          <label for="filter-segment" class="text-xs font-semibold uppercase tracking-wide text-slate-500">Season segment</label>
          <select
            id="filter-segment"
            name="segment"
            class="rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 text-sm text-slate-100 focus:outline-none focus:ring-2 focus:ring-amber-400"
          >
            <option value="">All segments</option>
            {% for value, label in segments %}
              <option value="{{ value }}" {% if value == selected_segment %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="flex flex-col gap-2">
          <label for="filter-sort" class="text-xs font-semibold uppercase tracking-wide text-slate-500">Sort by</label>
          <select
            id="filter-sort"
            name="sort"
            class="rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 text-sm text-slate-100 focus:outline-none focus:ring-2 focus:ring-amber-400"
          >
            {% for value, label in sort_options %}
              <option value="{{ value }}" {% if value == selected_sort %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="flex items-end gap-3">
          <button type="submit" class="theme-accent-bg theme-accent-shadow rounded-lg px-4 py-2 text-sm font-semibold">Apply filters</button>
          {% if score_filters_applied %}
            <a href="{% url 'predictions:leaderboard' %}" class="rounded-lg border border-slate-800 px-3 py-2 text-sm text-slate-300 transition hover:text-slate-100">Reset</a>
          {% endif %}
        </div>
      </form>

      {% if selected_tip_type_obj or selected_segment %}
        <div class="rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 text-xs text-slate-400">
          {% if selected_tip_type_obj %}
            <span>Tip type:</span>
            <span class="font-semibold text-slate-100">{{ selected_tip_type_obj.name }}</span>
          {% endif %}
          {% if selected_tip_type_obj and selected_segment %}
            <span class="px-1 text-slate-600">&middot;</span>
          {% endif %}
          {% if selected_segment %}
            <span>Segment:</span>
            <span class="font-semibold text-slate-100">
              {% for value, label in segments %}
                {% if value == selected_segment %}
                  {{ label }}
                {% endif %}
              {% endfor %}
            </span>
          {% endif %}
        </div>
      {% endif %}

      <div class="rounded-xl border border-slate-800 bg-slate-950">
        {% if leaderboard_rows %}
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-slate-800 text-sm">
              <thead>
                <tr class="text-xs uppercase tracking-wide text-slate-500">
                  <th scope="col" class="px-4 py-3 text-left">Rank</th>
                  <th scope="col" class="px-4 py-3 text-left">Player</th>
                  <th scope="col" class="px-4 py-3 text-right">Total points</th>
                  <th scope="col" class="px-4 py-3 text-right">Base picks</th>
                  <th scope="col" class="px-4 py-3 text-right">Bonus events</th>
                  <th scope="col" class="px-4 py-3 text-right">Lock bonuses</th>
                  <th scope="col" class="px-4 py-3 text-right">Events scored</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-slate-800 text-slate-200">
                {% for entry in leaderboard_rows %}
                  <tr class="hover:bg-slate-900/60">
                    <td class="px-4 py-3 text-left font-semibold text-slate-400">#{{ entry.rank }}</td>
                    <td class="px-4 py-3">
                      <p class="font-semibold text-slate-100">{{ entry.display_name }}</p>
                      <p class="text-xs text-slate-500">@{{ entry.username }}</p>
                    </td>
                    <td class="px-4 py-3 text-right">
                      <p class="text-lg font-bold text-amber-300">{{ entry.total_points }}</p>
                    </td>
                    <td class="px-4 py-3 text-right">
                      <p class="font-semibold text-slate-100">{{ entry.standard_points }}</p>
                      <p class="text-xs text-slate-500">Regular events</p>
                    </td>
                    <td class="px-4 py-3 text-right">
                      <p class="font-semibold text-amber-300">{{ entry.bonus_event_points }}</p>
                      <p class="text-xs text-slate-500">{{ entry.bonus_event_count }} bonus</p>
                    </td>
                    <td class="px-4 py-3 text-right">
                      <p class="font-semibold text-slate-100">{{ entry.lock_bonus_points }}</p>
                      <p class="text-xs text-slate-500">{{ entry.lock_bonus_count }} locks</p>
                    </td>
                    <td class="px-4 py-3 text-right">
                      <p class="font-semibold text-slate-100">{{ entry.event_count }}</p>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <div class="border-t border-slate-800 px-4 py-3 text-xs text-slate-500">
            Showing {{ result_count }} player{{ result_count|pluralize }}.
          </div>
        {% else %}
          <p class="px-4 py-5 text-sm text-slate-400">No scoring data is available yet. Once events are resolved the leaderboard will update automatically.</p>
        {% endif %}
      </div>
    </section>
  </div>
{% endblock %}
