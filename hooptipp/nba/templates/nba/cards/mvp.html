{% comment %}
NBA MVP prediction card.
Shows player options with portraits and current stats.
{% endcomment %}
{% load prediction_extras %}

<article class="prediction-card nba-mvp-card rounded-2xl border border-slate-800 bg-slate-900 p-5 shadow-lg">
  
  {# Header #}
  <header class="flex items-start justify-between gap-3">
    <div class="flex-1">
      <p class="text-xs uppercase tracking-wide text-slate-500">{{ event.tip_type.name }}</p>
      <h3 class="mt-1 text-lg font-semibold text-slate-100">{{ event.name }}</h3>
      {% if event.description %}
        <p class="mt-1 text-sm text-slate-400">{{ event.description }}</p>
      {% endif %}
    </div>
    <div class="text-right">
      <p class="text-xs text-slate-500">Deadline</p>
      <p class="text-xs font-semibold text-slate-300">{{ event.deadline|date:"M d, H:i" }}</p>
    </div>
  </header>
  
  {# Player Grid #}
  <div class="mt-4 grid grid-cols-2 gap-3">
    {% for option in event.options.all %}
      {% with player=card_context.players|get_item:option.option.id %}
        <label class="relative cursor-pointer rounded-lg border border-slate-800 bg-slate-950 p-3 transition hover:border-slate-700 hover:bg-slate-900">
          <input type="radio" 
                 name="prediction_{{ event.id }}" 
                 value="{{ option.id }}" 
                 form="tips-form" 
                 class="absolute top-2 right-2 h-4 w-4"
                 {% if user_tip and user_tip.prediction_option_id == option.id %}checked{% endif %} />
          
          {# Player Portrait #}
          {% if player.portrait_url %}
            <img src="{{ player.portrait_url }}" 
                 alt="{{ option.label }}" 
                 class="mx-auto h-20 w-20 rounded-full object-cover border-2 border-slate-700"
                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
            <div class="hidden mx-auto h-20 w-20 rounded-full bg-slate-800 items-center justify-center">
              <span class="text-2xl font-bold text-slate-600">
                {{ option.label|slice:":1" }}
              </span>
            </div>
          {% else %}
            <div class="mx-auto h-20 w-20 rounded-full bg-slate-800 flex items-center justify-center">
              <span class="text-2xl font-bold text-slate-600">
                {{ option.label|slice:":1" }}
              </span>
            </div>
          {% endif %}
          
          {# Player Info #}
          <div class="mt-3 text-center">
            <p class="font-semibold text-slate-200">{{ option.label }}</p>
            {% if player.team_tricode %}
              <p class="text-xs text-slate-400">{{ player.team_tricode }}</p>
            {% endif %}
            {% if player.current_stats %}
              <p class="mt-1 text-xs text-slate-500">
                {{ player.current_stats.ppg|floatformat:1 }} PPG
              </p>
            {% endif %}
          </div>
        </label>
      {% endwith %}
    {% endfor %}
  </div>
  
  {# Current MVP Standings #}
  {% if card_context.mvp_standings %}
    <div class="mt-4 rounded-lg border border-slate-800 bg-slate-950 p-3">
      <p class="text-xs uppercase tracking-wide text-slate-500 font-semibold">Current Leaders</p>
      <div class="mt-2 space-y-1">
        {% for standing in card_context.mvp_standings|slice:":5" %}
          <div class="flex justify-between text-sm">
            <span class="text-slate-300">{{ standing.rank }}. {{ standing.player }}</span>
            <span class="font-semibold theme-accent-text">{{ standing.score }}</span>
          </div>
        {% endfor %}
      </div>
    </div>
  {% endif %}
  
  {# Lock Option #}
  {% if active_user %}
    <div class="mt-4 flex items-center gap-2">
      <input type="checkbox" 
             name="lock_{{ event.id }}" 
             value="1" 
             form="tips-form" 
             class="h-4 w-4"
             {% if user_tip and user_tip.is_locked %}checked{% endif %} />
      <span class="text-sm text-slate-300">Lock this pick</span>
    </div>
  {% endif %}
  
  {# Footer - Points Badge and User Prediction Badges #}
  <div class="mt-4 flex flex-wrap items-center justify-between gap-2">
    <div class="flex flex-wrap items-center gap-2">
      <span class="theme-accent-pill rounded-full px-3 py-1 text-xs font-semibold uppercase">
        {{ event.points }} pt{{ event.points|pluralize }}
      </span>
      {% if event.is_bonus_event %}
        <span class="text-xs font-semibold text-amber-400">‚≠ê Bonus Event</span>
      {% endif %}
    </div>
    
    {# User Prediction Badges #}
    {% if users_who_predicted %}
      <div class="flex flex-wrap items-center gap-1">
        <span class="text-xs text-slate-500">Predicted by:</span>
        {% for user in users_who_predicted %}
          <span class="inline-flex items-center gap-1 rounded-full bg-slate-700/50 border border-slate-600/50 px-2 py-1 text-xs font-medium text-slate-300">
            {% if user.display_name %}
              {{ user.display_name }}
            {% else %}
              {{ user.username }}
            {% endif %}
          </span>
        {% endfor %}
      </div>
    {% endif %}
  </div>
  
</article>
