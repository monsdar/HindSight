{% comment %}
NBA game prediction card.
Shows team matchups with logos, venue, and game time.
{% endcomment %}

<article class="prediction-card nba-game-card rounded-2xl border border-slate-800 bg-slate-900 p-5 shadow-lg" 
         {% if card_context.is_live %}data-live-game-id="{{ event.source_event_id }}"{% endif %}>
  
  {# Header #}
  <header class="flex items-start justify-between gap-3">
    <div>
      <p class="text-xs uppercase tracking-wide text-slate-500">{{ event.tip_type.name }}</p>
      {% if card_context.playoff_context %}
        <p class="mt-1 text-xs font-semibold text-amber-400">
          {{ card_context.playoff_context.series_name }}
          {% if card_context.playoff_context.series_score %}
            ({{ card_context.playoff_context.series_score }})
          {% endif %}
        </p>
      {% endif %}
    </div>
    <div class="text-right">
      <p class="text-xs text-slate-500">Deadline</p>
      <p class="text-xs font-semibold text-slate-300">{{ event.deadline|date:"M d, H:i" }}</p>
    </div>
  </header>
  
  {# Team Matchup #}
  <div class="mt-4 rounded-lg border border-slate-800 bg-gradient-to-b from-slate-950 to-slate-900 p-4">
    <div class="flex items-center justify-between gap-4">
      
      {# Away Team #}
      <div class="flex-1 text-center">
        {% if card_context.away_team_logo %}
          <img src="{{ card_context.away_team_logo }}" 
               alt="{{ card_context.away_team }}" 
               class="mx-auto h-16 w-16 object-contain"
               onerror="this.style.display='none'" />
        {% endif %}
        <p class="mt-2 text-xl font-bold text-slate-200">
          {{ card_context.away_team_tricode }}
        </p>
        {% if card_context.away_score is not None %}
          <p class="away-score mt-1 text-3xl font-bold theme-accent-text">
            {{ card_context.away_score }}
          </p>
        {% endif %}
      </div>
      
      {# Separator #}
      <div class="flex flex-col items-center gap-1">
        <span class="text-2xl font-bold theme-accent-text">@</span>
        {% if card_context.game_status %}
          <span class="game-status text-xs font-semibold text-amber-400">
            {{ card_context.game_status }}
          </span>
        {% endif %}
      </div>
      
      {# Home Team #}
      <div class="flex-1 text-center">
        {% if card_context.home_team_logo %}
          <img src="{{ card_context.home_team_logo }}" 
               alt="{{ card_context.home_team }}" 
               class="mx-auto h-16 w-16 object-contain"
               onerror="this.style.display='none'" />
        {% endif %}
        <p class="mt-2 text-xl font-bold text-slate-200">
          {{ card_context.home_team_tricode }}
        </p>
        {% if card_context.home_score is not None %}
          <p class="home-score mt-1 text-3xl font-bold theme-accent-text">
            {{ card_context.home_score }}
          </p>
        {% endif %}
      </div>
      
    </div>
    
    {# Game Info #}
    <div class="mt-3 flex items-center justify-between text-xs text-slate-500">
      <span>{{ card_context.game_time|date:"M d, H:i" }}</span>
      {% if card_context.venue %}
        <span>{{ card_context.venue }}</span>
      {% endif %}
    </div>
  </div>
  
  {# Prediction Options #}
  {% if active_user %}
    <div class="mt-4 space-y-2 theme-accent-radio">
      <p class="text-xs font-semibold uppercase tracking-wide text-slate-400">Your pick</p>
      {% for option in event.options.all %}
        <label class="theme-accent-hover flex items-center gap-3 rounded-lg border border-slate-800 bg-slate-950 px-4 py-3 cursor-pointer transition">
          <input type="radio" 
                 name="prediction_{{ event.id }}" 
                 value="{{ option.id }}" 
                 form="tips-form" 
                 class="h-4 w-4 theme-accent-outline"
                 {% if user_tip and user_tip.prediction_option_id == option.id %}checked{% endif %} />
          <span class="flex-1 font-semibold text-slate-200">{{ option.label }}</span>
        </label>
      {% endfor %}
    </div>
    
    {# Lock Option #}
    <div class="mt-4 flex items-center justify-between">
      <label class="inline-flex items-center gap-2 text-sm text-slate-300 cursor-pointer">
        <input type="checkbox" 
               name="lock_{{ event.id }}" 
               value="1" 
               form="tips-form" 
               class="h-4 w-4 theme-accent-outline"
               {% if user_tip and user_tip.is_locked %}checked{% endif %}
               {% if lock_summary and lock_summary.available == 0 and not user_tip.is_locked %}disabled{% endif %} />
        <span>Lock this pick</span>
      </label>
      {% if user_tip and user_tip.is_locked %}
        <span class="theme-accent-pill rounded-full px-3 py-1 text-xs font-semibold uppercase">
          Locked
        </span>
      {% endif %}
    </div>
  {% else %}
    <p class="mt-4 text-sm text-slate-400 text-center py-2">
      Activate a user to make predictions
    </p>
  {% endif %}
  
  {# Footer - Points Badge and User Prediction Badges #}
  <div class="mt-4 flex flex-wrap items-center justify-between gap-2">
    <div class="flex flex-wrap items-center gap-2">
      <span class="theme-accent-pill rounded-full px-3 py-1 text-xs font-semibold uppercase">
        {{ event.points }} pt{{ event.points|pluralize }}
      </span>
      {% if event.is_bonus_event %}
        <span class="text-xs font-semibold text-amber-400">‚≠ê Bonus Event</span>
      {% endif %}
    </div>
    
    {# User Prediction Badges #}
    {% if users_who_predicted %}
      <div class="flex flex-wrap items-center gap-1">
        <span class="text-xs text-slate-500">Predicted by:</span>
        {% for user in users_who_predicted %}
          <span class="inline-flex items-center gap-1 rounded-full bg-slate-700/50 border border-slate-600/50 px-2 py-1 text-xs font-medium text-slate-300">
            {% if user.display_name %}
              {{ user.display_name }}
            {% else %}
              {{ user.username }}
            {% endif %}
          </span>
        {% endfor %}
      </div>
    {% endif %}
  </div>
  
</article>
